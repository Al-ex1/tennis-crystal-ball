<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--@thymesVar id="player" type="org.strangeforest.tcb.stats.model.Player"-->
<!--@thymesVar id="seasons" type="java.util.List<java.lang.Integer>"-->
<!--@thymesVar id="tournaments" type="java.util.List<org.strangeforest.tcb.stats.model.Tournament>"-->
<!--@thymesVar id="season" type="java.lang.Integer"-->
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title th:text="'Ultimate Tennis Statistics - ' + (${player} ? ${player.name} : 'Player Profile')">Ultimate Tennis Statistics - Player Profile</title>
	<link th:href="@{webjars/bootstrap/3.3.5/css/bootstrap.min.css}" rel="stylesheet" media="screen"/>
	<link th:href="@{webjars/jquery-ui-themes/1.11.4/smoothness/jquery-ui.css}" rel="stylesheet" media="screen"/>
	<link th:href="@{webjars/jquery.bootgrid/1.2.0/dist/jquery.bootgrid.min.css}" rel="stylesheet" media="screen"/>
	<link th:href="@{css/tennis-stats.css}" rel="stylesheet" media="screen"/>
	<script th:src="@{webjars/jquery/2.1.4/jquery.min.js}"></script>
	<script th:src="@{webjars/jquery-ui/1.11.4/jquery-ui.min.js}"></script>
	<script th:src="@{webjars/bootstrap/3.3.5/js/bootstrap.min.js}"></script>
	<script th:src="@{webjars/jquery.bootgrid/1.2.0/dist/jquery.bootgrid.min.js}"></script>
	<script th:src="@{js/formatters.js}"></script>
	<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/
		$(function() {
			$("#player").autocomplete({
				source: "autocompletePlayer",
				minLength: 2,
				select: function(event, ui) {
					if (ui.item)
						window.location = "playerProfile?playerId=" + ui.item.id;
				}
			}).focus();
			$("[data-toggle=pill]").click(function(event) {
				event.preventDefault();
				var $pill = $(this);
				if ($pill.hasClass("loaded"))
					return;
				var url = $pill.attr("data-url");
				if (typeof url !== "undefined") {
					var $pane = this.hash;
					$($pane).load(url, function() {
						if (!$pill.hasClass("loaded"))
							$pill.addClass("loaded");
						$pill.tab("show");
					});
				} else
					$pill.tab("show");
			});
		});
		function showTitles(level) {
			clearTournamentsFilterControls();
			$("#level").val(level);
			$("#result").val("W");
			reloadTournaments();
			$("#tournamentsPill").tab("show");
		}
		function toggleStatsData(selector) {
			$(selector).find(".pct-data, .raw-data").toggle();
		}
		/*]]>*/
	</script>
</head>
<body class="container">
	<div th:include="fragments/header :: title"></div>
	<div class="row">
		<div th:if="${player}" class="col-md-8">
			<h3 th:text="${player.name}">Player Profile</h3>
		</div>
		<div class=" col-md-4">
			<div class="ui-widget input-group">
				<label for="player" class="input-group-addon">Player:</label>
				<input id="player" type="text" class="search-field form-control" placeholder="Search Player"/>
			</div>
		</div>
	</div>
	<th:block th:if="${player}">
		<div class="row">
			<div class="col-md-3">
				<table class="table table-condensed text-nowrap">
					<!--/* General */-->
					<tr th:if="${player.dob}">
						<th>Age</th>
						<td th:text="|${player.age} (${#dates.format(player.dob, 'dd-MM-yyyy')})|">25 (1-1-1990)</td>
					</tr>
					<tr>
						<th>Country</th>
						<td><img th:src="@{images/flags/{code}.png(code=${player.countryCode})}" src="images/flags/us.png" th:title="${player.countryId}" title="USA" width="24" height="20"/> <span th:text="${player.countryName}">United States</span></td>
					</tr>
					<tr th:if="${player.birthplace}">
						<th>Birthplace</th>
						<td th:text="${player.birthplace}">New York</td>
					</tr>
					<tr th:if="${player.residence}">
						<th>Residence</th>
						<td th:text="${player.residence}">New York</td>
					</tr>
					<tr th:if="${player.height > 0}">
						<th>Height</th>
						<td th:text="|${player.height} cm|">180 cm</td>
					</tr>
					<tr th:if="${player.weight > 0}">
						<th>Weight</th>
						<td th:text="|${player.weight} kg|">80 kg</td>
					</tr>
					<tr th:if="${player.hand}">
						<th>Plays</th>
						<td th:text="${player.handName}">Right-handed</td>
					</tr>
					<tr th:if="${player.backhand}">
						<th>Backhand</th>
						<td th:text="${player.backhandName}">Two-handed</td>
					</tr>
				</table>
			</div>
			<div class="col-md-1">&nbsp;</div>
			<div class="col-md-3">
				<table class="table table-condensed text-nowrap">
					<!--/* Titles */-->
					<tr th:if="${player.titles > 0}">
						<th>Titles</th>
						<td width="100%"><a class="label label-default" th:text="${player.titles}" href="javascript:showTitles()" title="Show titles">10</a></td>
					</tr>
					<tr th:if="${player.grandSlams > 0}">
						<th>Grand Slams</th>
						<td><a class="label label-danger" th:text="${player.grandSlams}" href="javascript:showTitles('G')" title="Show Grand Slam titles">1</a></td>
					</tr>
					<tr th:if="${player.tourFinals > 0}">
						<th>Tour Finals</th>
						<td><a class="label label-warning" th:text="${player.tourFinals}" href="javascript:showTitles('F')" title="Show Tour Finals titles">1</a></td>
					</tr>
					<tr th:if="${player.masters > 0}">
						<th>Masters</th>
						<td><a class="label label-info" th:text="${player.masters}" href="javascript:showTitles('M')" title="Show Masters titles">5</a></td>
					</tr>
					<tr th:if="${player.olympics > 0}">
						<th>Olympics</th>
						<td><a class="label label-success" th:text="${player.olympics}" href="javascript:showTitles('O')" title="Show Olympics titles">1</a></td>
					</tr>
					<!--/* Ranking */-->
					<tr th:if="${player.currentRank > 0}">
						<th>Current Rank</th>
						<td th:text="${player.currentRank} + ' (' + ${player.currentRankPoints} + ')'">10 (3000)</td>
					</tr>
					<tr th:if="${player.bestRank > 0}">
						<th>Best Rank</th>
						<td th:text="${player.bestRank} + ' (' + ${#dates.format(player.bestRankDate, 'dd-MM-yyyy')} + ')'">5 (1.1.2010)</td>
					</tr>
					<tr th:if="${player.bestRankPoints > 0}">
						<th>Best Rank Points</th>
						<td th:text="${player.bestRankPoints} + ' (' + ${#dates.format(player.bestRankPointsDate, 'dd-MM-yyyy')} + ')'">5000 (1.1.2011)</td>
					</tr>
					<tr th:if="${player.goatRankPoints > 0}">
						<th>GOAT Rank</th>
						<td th:text="${player.goatRank} + ' (' + ${player.goatRankPoints} + ')'">50 (2500)</td>
					</tr>
				</table>
			</div>
			<div class="col-md-1">&nbsp;</div>
			<div class="col-md-4">
				<table class="table table-condensed text-nowrap">
					<!--/* Tennis */-->
					<tr th:if="${player.turnedPro > 0}">
						<th>Turned Pro</th>
						<td th:text="${player.turnedPro}">2005</td>
					</tr>
					<tr th:if="${player.coach}">
						<th>Coach</th>
						<td th:text="${player.coach}">Brad Gilbert</td>
					</tr>
 					<!--/* Social */-->
					<tr th:if="${player.webSite}">
						<th>Web Site</th>
						<td><a th:href="'http://' + ${player.webSite}" href="http://www.johnsmith.com" target="_blank" th:text="${player.webSite}">www.johnsmith.com</a></td>
					</tr>
					<tr th:if="${player.twitter}">
						<th>Twitter</th>
						<td><a th:href="'https://twitter.com/' + ${player.twitter}" href="https://twitter.com/JohnSmith" target="_blank" th:text="'@'+ ${player.twitter}">@JohnSmith</a></td>
					</tr>
					<tr th:if="${player.facebook}">
						<th>Facebook</th>
						<td><a th:href="'https://www.facebook.com/' + ${player.facebook}" href="https://www.facebook.com/JohnSmith" target="_blank" th:text="${player.facebook}">JohnSmith</a></td>
					</tr>
				</table>
			</div>
		</div>

		<ul id="playerPills" class="nav nav-pills">
			<li class="active"><a id="tournamentsPill" data-toggle="pill" href="#tournaments">Tournaments</a></li>
			<li><a id="matchesPill" data-toggle="pill" href="#matches" data-url="playerMatches?playerId=" th:attrappend="data-url=${player.id}">Matches</a></li>
			<li><a data-toggle="pill" href="#timeline" data-url="playerTimeline?playerId=" th:attrappend="data-url=${player.id}">Timeline</a></li>
			<li><a data-toggle="pill" href="#rivalries" data-url="playerRivalries?playerId=" th:attrappend="data-url=${player.id}">Rivalries</a></li>
			<li><a data-toggle="pill" href="#performance" data-url="playerPerformance?playerId=" th:attrappend="data-url=${player.id}">Performance</a></li>
			<li><a data-toggle="pill" href="#statistics" data-url="playerStatsTab?playerId=" th:attrappend="data-url=${player.id}">Statistics</a></li>
		</ul>

		<div class="tab-content">
			<div id="tournaments" class="tab-pane fade in active">
				<!--/* Tournaments */-->
				<script type="text/javascript" th:inline="javascript">
					/*<![CDATA[*/
					$(function() {
						$("[data-toggle='tooltip']").tooltip();
						$("#tournamentsTable").bootgrid({
							ajax: true,
							ajaxSettings: {
								method: "GET",
								cache: false
							},
							url: "/playerTournamentsTable?playerId=[[${player.id}]]",
							requestHandler: function (request) {
								request.season = $("#season").val();
								request.level = $("#level").val();
								request.surface = $("#surface").val();
								request.tournamentId = $("#tournament").val();
								request.result = $("#result").val();
								return request;
							},
							rowCount: [10, 20, 50, -1],
							formatters: {
								"date": dateFormatter,
								"level": levelFormatter,
								"surface": surfaceFormatter,
								"result": function(column, row) {
									return "<a class='label black bg-result-" + row.result + "' href='javascript:playerMatches(" + row.tournamentEventId + ")' title='Show matches'>" + row.result + "</a>"
								},
								"stats": function(column, row) {
									return "<a id='eventStats-" + row.tournamentEventId + "' href='#' class='label label-info glyphicon glyphicon-stats' onclick='showEventStats(" + row.tournamentEventId + ", event)' title='" + row.name + " " + row.season + " Statistics'> Stats</a>";
								}
							},
							labels: {
								noResults: "No tournaments found"
							}
						});
					});
					function reloadTournaments() {
						$("#tournamentsTable").bootgrid("reload");
					}
					function clearTournamentsFilterControls() {
						$("#season").val("");
						$("#level").val("");
						$("#surface").val("");
						$("#tournament").val("");
						$("#result").val("");
						$("#tournamentsTable").bootgrid("search", "");
					}
					function clearTournamentsFilter() {
						clearTournamentsFilterControls();
						reloadTournaments();
					}
					function playerMatches(tournamentEventId) {
						var $pill = $("#matchesPill");
						var $pane = $("#matches");
						var url = $pill.attr("data-url");
						$($pane).load(url + "&tournamentEventId=" + tournamentEventId, function() {
							if (!$pill.hasClass("loaded"))
								$pill.addClass("loaded");
							$pill.tab("show");
						});
					}
					function showEventStats(tournamentEventId, event) {
						var $eventStats = $("#eventStats-" + tournamentEventId);
						if (!$eventStats.hasClass("loaded")) {
							event.preventDefault();
							$.get("eventStats?playerId=[[${player.id}]]&tournamentEventId=" + tournamentEventId, function(data) {
								$eventStats.addClass("loaded").popover({content: data, html: true, placement: "auto right"});
								$eventStats.on("show.bs.popover", function() { $(this).data("bs.popover").tip().css("max-width", "800px"); }).click();
							});
						}
					}
					/*]]>*/
				</script>
				<br/>
				<div class="row">
					<div class="col-md-2">
						<select id="season" class="form-control" onchange="reloadTournaments()" data-toggle="tooltip" data-placement="top" title="Filter seasons">
							<option value="">All seasons</option>
							<option th:each="aSeason : ${seasons}" th:value="${aSeason}" value="2005" th:text="${aSeason}" th:selected="${aSeason == season}">2005</option>
						</select>
					</div>
					<div class="col-md-2">
						<select id="level" class="form-control" onchange="reloadTournaments()" data-toggle="tooltip" data-placement="top" title="Filter by tournament level">
							<option value="">All levels</option>
							<option value="G" class="bg-level-G">Grand Slam</option>
							<option value="F" class="bg-level-F">Tour Finals</option>
							<option value="M" class="bg-level-M">Masters</option>
							<option value="A" class="bg-level-A">ATP</option>
							<option value="O" class="bg-level-O">Olympics</option>
						</select>
					</div>
					<div class="col-md-2">
						<select id="surface" class="form-control" onchange="reloadTournaments()" data-toggle="tooltip" data-placement="top" title="Filter by surface">
							<option value="">All surfaces</option>
							<option value="H" class="bg-surface-H">Hard</option>
							<option value="C" class="bg-surface-C">Clay</option>
							<option value="G" class="bg-surface-G">Grass</option>
							<option value="P" class="bg-surface-P">Carpet</option>
						</select>
					</div>
					<div class="col-md-2">
						<select id="tournament" class="form-control" onchange="reloadTournaments()" data-toggle="tooltip" data-placement="top" title="Filter tournaments">
							<option value="">All tournaments</option>
							<option th:each="tournament : ${tournaments}" th:if="${tournament.level != 'D'}" th:value="${tournament.id}" value="101" th:text="${tournament.name}" th:class="'bg-level-' + ${tournament.level}">Wimbledon</option>
						</select>
					</div>
					<div class="col-md-2">
						<select id="result" class="form-control" onchange="reloadTournaments()" data-toggle="tooltip" data-placement="top" title="Filter by result">
							<option value="">All results</option>
							<option value="W" class="bg-result-W">Win</option>
							<option value="F" class="bg-result-F">Final</option>
							<option value="SF" class="bg-result-SF">Semi-Final</option>
							<option value="QF" class="bg-result-QF">Quarter-Final</option>
							<option value="R16" class="bg-result-R16">Round of 16</option>
							<option value="R32" class="bg-result-R32">Round of 32</option>
							<option value="R64" class="bg-result-R64">Round of 64</option>
							<option value="R128" class="bg-result-R128">Round of 128</option>
							<option value="RR" class="bg-result-RR">Round-Robin</option>
							<option value="BR" class="bg-result-BR">Bronze Medal</option>
						</select>
					</div>
					<div class="col-md-1">
						<button type="button" class="btn btn-default" onclick="clearTournamentsFilter()" data-toggle="tooltip" data-placement="top" title="Clear all filters">
							<span class="glyphicon glyphicon-remove"></span> Clear
						</button>
					</div>
				</div>
				<table id="tournamentsTable" class="table table-condensed table-hover table-striped">
					<thead>
						<tr>
							<th data-column-id="date" data-formatter="date" data-order="desc" data-width="80">Date</th>
							<th data-column-id="level" data-formatter="level" data-width="100">Level</th>
							<th data-column-id="surface" data-formatter="surface" data-width="80">Surface</th>
							<th data-column-id="name" data-width="200">Tournament</th>
							<th data-column-id="result" data-formatter="result" data-width="50">Result</th>
							<th data-column-id="stats" data-formatter="stats" data-sortable="false" data-width="50">Stats</th>
						</tr>
					</thead>
				</table>
			</div>
			<div id="matches" class="tab-pane fade"><br/>Loading...</div>
			<div id="timeline" class="tab-pane fade"><br/>Loading...</div>
			<div id="rivalries" class="tab-pane fade"><br/>Loading...</div>
			<div id="performance" class="tab-pane fade"><br/>Loading...</div>
			<div id="statistics" class="tab-pane fade"><br/>Loading...</div>
		</div>
	</th:block>
	<div th:include="fragments/footer :: copy"></div>
</body>
</html>