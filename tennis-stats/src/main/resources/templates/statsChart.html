<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--@thymesVar id="seasons" type="java.util.List<java.lang.Integer>"-->
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>Ultimate Tennis Statistics - Statistics Chart</title>
	<link th:href="@{/webjars/bootstrap/3.3.6/css/bootstrap.min.css}" rel="stylesheet" media="screen"/>
	<link th:href="@{/webjars/jquery-ui-themes/1.11.4/smoothness/jquery-ui.css}" rel="stylesheet" media="screen"/>
	<link th:href="@{/css/tennis-stats.css}" rel="stylesheet" media="screen"/>
	<script th:src="@{/webjars/jquery/2.2.1/jquery.min.js}"></script>
	<script th:src="@{/webjars/jquery-ui/1.11.4/jquery-ui.min.js}"></script>
	<script th:src="@{/webjars/bootstrap/3.3.6/js/bootstrap.min.js}"></script>
	<script th:src="@{/js/tennis-stats.js}"></script>
	<script th:src="@{/js/tennis-chart.js}"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		/*<![CDATA[*/
		google.load("visualization", "1.0", {packages:["corechart"]});
		var chartData, pointCount, legendPosition;
		function drawChart() {
			var players = $.trim($("#players").val());
			if (getPlayerCount(players) >= 1)
				doDrawChart();
			else
				$("#statsChart").html("<div class='row'><div class='col-md-9'><div class='alert alert-warning'>No player selected!</div></div></div>");
		}
		function doDrawChart() {
			var players = $("#players").val();
			var category = $("#category").val();
			var dataUrl = "/playerStatisticsTable?players=" + players + "&category=" + category;
			dataUrl += "&fromSeason=" + $("#fromSeason").val() + "&toSeason=" + $("#toSeason").val();
			dataUrl += "&byAge=" + $("#byAge").prop("checked");
			$("#statsChart").html("");
			var $loading = $("#loading");
			$loading.show();
			$.ajax(dataUrl).done(function(json) {
				chartData = new google.visualization.DataTable(JSON.stringify(json));
				pointCount = json.rows.length;
				legendPosition = json.cols.length < 5 ? "bottom" : "right";
				var width = $("#statsChartSize").slider("value");
				showChart(chartData, "statsChart", width, true, pointCount, 1, 0, false, legendPosition);
			}).always(function() {
				$loading.hide().css("position", "absolute").css("z-index", "100");
			});
		}
		$(function() {
			autocompletePlayers("players", drawChart);
			$("#statsChartSize").slider({
				min: 500,
				max: 1500,
				value: 1000,
				step: 100,
				slide: function(event, ui) {
					showChart(chartData, "statsChart", ui.value, true, pointCount, 1, 0, false, legendPosition);
				}
			});
			$("[data-toggle='tooltip']").tooltip();
		});
		/*]]>*/
	</script>
	<style>
		.checkbox {
			margin-top: 7px;
			margin-bottom: 7px;
		}
	</style>
</head>
<body class="container">
	<div th:include="fragments/header :: title"></div>
	<h3>Statistics Chart</h3>
	<div class="row">
		<div class="col-md-9">
			<div class="input-group">
				<label for="players" class="input-group-addon">Players:</label>
				<input id="players" type="text" class="ui-widget search-field form-control" placeholder="Search Players"/>
			</div>
		</div>
	</div>
	<div style="height: 5px"></div>
	<div class="row">
		<div class="col-md-3">
			<div class="input-group">
				<label for="category" class="input-group-addon">Category:</label>
				<select id="category" class="form-control">
					<optgroup label="Serve">
						<option value="aces" selected="selected">Aces</option>
						<option value="acePct">Ace %</option>
						<option value="doubleFaultPct">Double Fault %</option>
						<option value="firstServePct">1st Serve</option>
						<option value="firstServeWonPct">1st Serve Won</option>
						<option value="secondServeWonPct">2nd Serve Won</option>
						<option value="breakPointsSavedPct">Break Points Saved</option>
						<option value="servicePointsWonPct">Service Pts. Won</option>
						<option value="serviceGamesWonPct">Service Games Won</option>
					</optgroup>
					<optgroup label="Return">
						<option value="aceAgainstPct">Ace Against %</option>
						<option value="doubleFaultAgainstPct">Dbl. Flt. Against %</option>
						<option value="firstServeReturnWonPct">1st Srv. Rtn. Won</option>
						<option value="secondServeReturnWonPct">2nd Srv. Rtn. Won</option>
						<option value="breakPointsPct">Break Points</option>
						<option value="returnPointsWonPct">Return Pts. Won</option>
						<option value="returnGamesWonPct">Return Games Won</option>
					</optgroup>
					<optgroup label="Total">
						<option value="pointsDominanceRatio" th:title="#{stats.pointsDominanceRatio.title}">Points Dominance</option>
						<option value="gamesDominanceRatio" th:title="#{stats.gamesDominanceRatio.title}">Games Dominance</option>
						<option value="breakPointsRatio" th:title="#{stats.breakPointsRatio.title}">Brk. Pts. Ratio</option>
						<option value="overPerformingRatio" th:title="#{stats.overPerformingRatio.title}">Over-Performing</option>
						<option value="totalPointsWonPct">Total Pts. Won</option>
						<option value="totalGamesWonPct">Total Games Won</option>
						<option value="setsWonPct">Sets Won</option>
						<option value="matchesWonPct">Matches Won</option>
					</optgroup>
				</select>
			</div>
		</div>
		<div class="col-md-4">
			<div class="input-group">
				<label for="fromSeason" class="input-group-addon">From:</label>
				<select id="fromSeason" class="form-control" data-toggle="tooltip" data-placement="top" title="Select from season">
					<option value="">All seasons</option>
					<option th:each="season : ${seasons}" th:value="${season}" value="2005" th:text="${season}">2005</option>
				</select>
				<label for="toSeason" class="input-group-addon">To:</label>
				<select id="toSeason" class="form-control" data-toggle="tooltip" data-placement="top" title="Select to season">
					<option value="">All seasons</option>
					<option th:each="season : ${seasons}" th:value="${season}" value="2005" th:text="${season}">2005</option>
				</select>
			</div>
		</div>
		<div class="col-md-2">
			<div class="checkbox">
				<label data-toggle="tooltip" data-placement="top" title="Show chart by age">
					<input id="byAge" type="checkbox"/> By age
				</label>
			</div>
		</div>
	</div>
	<div style="height: 5px"></div>
	<div class="row">
		<div class="col-md-2">
			<div id="statsChartSize" style="margin-top: 6px"></div>
			<div style="text-align: center; opacity: 0.5">Chart size</div>
		</div>
		<div class="col-md-2">
			<a class="btn btn-primary pull-right" href="#" role="button" onclick="drawChart()">
				<span class="glyphicon glyphicon-signal"></span>&nbsp;&nbsp;Draw Chart
			</a>
		</div>
	</div>
	<div class="row">
		<div class="row col-md-9 text-center">
			<div id="loading" style="width: 100%; display: none">
				<br/>
				<img src="/images/loading.gif" width="128" height="128" alt="Loading chart..."/>
				<br/>
			</div>
		</div>
	</div>
	<div id="statsChart"></div>
	<div th:include="fragments/footer :: copy"></div>
</body>
</html>